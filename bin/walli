#!/usr/bin/env node

const Walli = require('../dist/Walli').default;
const deepMerge = require('../dist/Utils').deepMerge;
const CoreClient = require('../dist/CoreClient').default;
const { argv } = require('yargs')
  .options({
    config: {
      type: 'string',
      default: 'walli.json',
    },
    logfile: {
      describe: 'Path to the logfile',
      type: 'string',
      default: 'walli.log',
    },
    'db.database': {
      describe: 'SQL database name',
      type: 'string',
      default: 'walli',
    },
    'db.host': {
      describe: 'Hostname for SQL database',
      type: 'string',
      default: 'localhost',
    },
    'db.port': {
      describe: 'Port for SQL database',
      type: 'number',
      default: 3306,
    },
    'db.username': {
      describe: 'User for SQL database ',
      type: 'string',
      default: 'walli',
    },
    'db.password': {
      describe: 'Password for SQL database ',
      type: 'string',
    },
    'xud.host': {
      describe: 'Host of the xud gRPC interface',
      type: 'string',
      default: 'localhost',
    },
    'xud.port': {
      describe: 'Port of the xud gRPC interface',
      type: 'number',
      default: 8886,
    },
    'api.host': {
      describe: 'Host of the API',
      type: 'string',
      default: '0.0.0.0',
    },
    'api.port': {
      describe: 'Port of the API',
      type: 'number',
      default: 8887,
    },
    'rpc.host': {
      describe: 'Host of the RPC',
      type: 'string',
      default: '127.0.0.1',
    },
    'rpc.port': {
      describe: 'Port of the RPC',
      type: 'string',
      default: '18334',
    },
    'rpc.username': {
      describe: 'User name for RPC',
      type: 'string',
      default: 'uesr',
    },
    'rpc.password': {
      describe: 'Password for RPC',
      type: 'string',
    },
  }).config();

// Delete non-config keys from argv
delete argv._;
delete argv.version;
delete argv.help;
delete argv.$0;

const config = {};

deepMerge(config, argv);
const walli = new Walli(config);
walli.start();
